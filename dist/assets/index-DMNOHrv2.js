import{r as i,t as j,ab as qt,b as re,x as ye,$ as ts,Y as A,z as W,ac as ns,B as ss,E as je,R as Pe,_ as un,F as dn,n as rs,o as Yt,H as Ie,a0 as os,f as hn,C as kt,q as fn,ad as is,ae as Xt,af as as,ag as cs,ah as ls,O as us,Q as ds,L as f,ai as hs,aj as fs,V as Se,N as ms,ak as ps,al as gs}from"./index-C8eSy4OC.js";import{D as vs,g as ys,i as ws,e as vt,f as yt,S as mn,h as pn,j as xs,k as bs,c as Cs,T as gn,L as vn,b as Es,l as _s}from"./index-MBFafklJ.js";import{I as oe,aC as Ss,K as wt,t as xt,m as Rs,R as Ts,a as yn,b as wn,g as tt,u as Ms,aD as Ns,v as Os,Z as ks,B as ve,a1 as Ps,a2 as Wt,a6 as Kt,a7 as Is,a4 as fe,a3 as rt,a5 as Be,a8 as Pt,aE as As,aF as Ls,aa as It,aG as xn,ab as bn,ac as Cn}from"./zod-BXeWywGr.js";var js={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},Bs=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:js}))},$s=i.forwardRef(Bs);function En(){var n=document.documentElement.clientWidth,e=window.innerHeight||document.documentElement.clientHeight;return{width:n,height:e}}function Ds(n){var e=n.getBoundingClientRect(),t=document.documentElement;return{left:e.left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||document.body.clientLeft||0),top:e.top+(window.pageYOffset||t.scrollTop)-(t.clientTop||document.body.clientTop||0)}}function Ae(n,e,t,s){var r=qt.unstable_batchedUpdates?function(a){qt.unstable_batchedUpdates(t,a)}:t;return n!=null&&n.addEventListener&&n.addEventListener(e,r,s),{remove:function(){n!=null&&n.removeEventListener&&n.removeEventListener(e,r,s)}}}var Ve=i.createContext(null),zs=function(e){var t=e.visible,s=e.maskTransitionName,r=e.getContainer,o=e.prefixCls,a=e.rootClassName,c=e.icons,l=e.countRender,d=e.showSwitch,h=e.showProgress,u=e.current,m=e.transform,p=e.count,g=e.scale,v=e.minScale,b=e.maxScale,w=e.closeIcon,_=e.onActive,S=e.onClose,R=e.onZoomIn,y=e.onZoomOut,N=e.onRotateRight,C=e.onRotateLeft,x=e.onFlipX,T=e.onFlipY,M=e.onReset,E=e.toolbarRender,P=e.zIndex,k=e.image,I=i.useContext(Ve),D=c.rotateLeft,K=c.rotateRight,U=c.zoomIn,Z=c.zoomOut,z=c.close,q=c.left,G=c.right,ee=c.flipX,Q=c.flipY,ce="".concat(o,"-operations-operation");i.useEffect(function(){var F=function(V){V.keyCode===wt.ESC&&S()};return t&&window.addEventListener("keydown",F),function(){window.removeEventListener("keydown",F)}},[t]);var ne=function(H,V){H.preventDefault(),H.stopPropagation(),_(V)},L=i.useCallback(function(F){var H=F.type,V=F.disabled,te=F.onClick,Y=F.icon;return i.createElement("div",{key:H,className:re(ce,"".concat(o,"-operations-operation-").concat(H),ye({},"".concat(o,"-operations-operation-disabled"),!!V)),onClick:te},Y)},[ce,o]),se=d?L({icon:q,onClick:function(H){return ne(H,-1)},type:"prev",disabled:u===0}):void 0,le=d?L({icon:G,onClick:function(H){return ne(H,1)},type:"next",disabled:u===p-1}):void 0,ie=L({icon:Q,onClick:T,type:"flipY"}),B=L({icon:ee,onClick:x,type:"flipX"}),me=L({icon:D,onClick:C,type:"rotateLeft"}),J=L({icon:K,onClick:N,type:"rotateRight"}),ae=L({icon:Z,onClick:y,type:"zoomOut",disabled:g<=v}),pe=L({icon:U,onClick:R,type:"zoomIn",disabled:g===b}),be=i.createElement("div",{className:"".concat(o,"-operations")},ie,B,me,J,ae,pe);return i.createElement(ts,{visible:t,motionName:s},function(F){var H=F.className,V=F.style;return i.createElement(Ss,{open:!0,getContainer:r??document.body},i.createElement("div",{className:re("".concat(o,"-operations-wrapper"),H,a),style:A(A({},V),{},{zIndex:P})},w===null?null:i.createElement("button",{className:"".concat(o,"-close"),onClick:S},w||z),d&&i.createElement(i.Fragment,null,i.createElement("div",{className:re("".concat(o,"-switch-left"),ye({},"".concat(o,"-switch-left-disabled"),u===0)),onClick:function(Y){return ne(Y,-1)}},q),i.createElement("div",{className:re("".concat(o,"-switch-right"),ye({},"".concat(o,"-switch-right-disabled"),u===p-1)),onClick:function(Y){return ne(Y,1)}},G)),i.createElement("div",{className:"".concat(o,"-footer")},h&&i.createElement("div",{className:"".concat(o,"-progress")},l?l(u+1,p):i.createElement("bdi",null,"".concat(u+1," / ").concat(p))),E?E(be,A(A({icons:{prevIcon:se,nextIcon:le,flipYIcon:ie,flipXIcon:B,rotateLeftIcon:me,rotateRightIcon:J,zoomOutIcon:ae,zoomInIcon:pe},actions:{onActive:_,onFlipY:T,onFlipX:x,onRotateLeft:C,onRotateRight:N,onZoomOut:y,onZoomIn:R,onReset:M,onClose:S},transform:m},I?{current:u,total:p}:{}),{},{image:k})):be)))})},We={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function Fs(n,e,t,s){var r=i.useRef(null),o=i.useRef([]),a=i.useState(We),c=W(a,2),l=c[0],d=c[1],h=function(g){d(We),ns(We,l)||s?.({transform:We,action:g})},u=function(g,v){r.current===null&&(o.current=[],r.current=ss(function(){d(function(b){var w=b;return o.current.forEach(function(_){w=A(A({},w),_)}),r.current=null,s?.({transform:w,action:v}),w})})),o.current.push(A(A({},l),g))},m=function(g,v,b,w,_){var S=n.current,R=S.width,y=S.height,N=S.offsetWidth,C=S.offsetHeight,x=S.offsetLeft,T=S.offsetTop,M=g,E=l.scale*g;E>t?(E=t,M=t/l.scale):E<e&&(E=_?E:e,M=E/l.scale);var P=b??innerWidth/2,k=w??innerHeight/2,I=M-1,D=I*R*.5,K=I*y*.5,U=I*(P-l.x-x),Z=I*(k-l.y-T),z=l.x-(U-D),q=l.y-(Z-K);if(g<1&&E===1){var G=N*E,ee=C*E,Q=En(),ce=Q.width,ne=Q.height;G<=ce&&ee<=ne&&(z=0,q=0)}u({x:z,y:q,scale:E},v)};return{transform:l,resetTransform:h,updateTransform:u,dispatchZoomChange:m}}function Zt(n,e,t,s){var r=e+t,o=(t-s)/2;if(t>s){if(e>0)return ye({},n,o);if(e<0&&r<s)return ye({},n,-o)}else if(e<0||r>s)return ye({},n,e<0?o:-o);return{}}function _n(n,e,t,s){var r=En(),o=r.width,a=r.height,c=null;return n<=o&&e<=a?c={x:0,y:0}:(n>o||e>a)&&(c=A(A({},Zt("x",t,n,o)),Zt("y",s,e,a))),c}var Le=1,Hs=1;function Vs(n,e,t,s,r,o,a){var c=r.rotate,l=r.scale,d=r.x,h=r.y,u=i.useState(!1),m=W(u,2),p=m[0],g=m[1],v=i.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),b=function(y){!e||y.button!==0||(y.preventDefault(),y.stopPropagation(),v.current={diffX:y.pageX-d,diffY:y.pageY-h,transformX:d,transformY:h},g(!0))},w=function(y){t&&p&&o({x:y.pageX-v.current.diffX,y:y.pageY-v.current.diffY},"move")},_=function(){if(t&&p){g(!1);var y=v.current,N=y.transformX,C=y.transformY,x=d!==N&&h!==C;if(!x)return;var T=n.current.offsetWidth*l,M=n.current.offsetHeight*l,E=n.current.getBoundingClientRect(),P=E.left,k=E.top,I=c%180!==0,D=_n(I?M:T,I?T:M,P,k);D&&o(A({},D),"dragRebound")}},S=function(y){if(!(!t||y.deltaY==0)){var N=Math.abs(y.deltaY/100),C=Math.min(N,Hs),x=Le+C*s;y.deltaY>0&&(x=Le/x),a(x,"wheel",y.clientX,y.clientY)}};return i.useEffect(function(){var R,y,N,C;if(e){N=Ae(window,"mouseup",_,!1),C=Ae(window,"mousemove",w,!1);try{window.top!==window.self&&(R=Ae(window.top,"mouseup",_,!1),y=Ae(window.top,"mousemove",w,!1))}catch{}}return function(){var x,T,M,E;(x=N)===null||x===void 0||x.remove(),(T=C)===null||T===void 0||T.remove(),(M=R)===null||M===void 0||M.remove(),(E=y)===null||E===void 0||E.remove()}},[t,p,d,h,c,e]),{isMoving:p,onMouseDown:b,onMouseMove:w,onMouseUp:_,onWheel:S}}function Us(n){return new Promise(function(e){if(!n){e(!1);return}var t=document.createElement("img");t.onerror=function(){return e(!1)},t.onload=function(){return e(!0)},t.src=n})}function Sn(n){var e=n.src,t=n.isCustomPlaceholder,s=n.fallback,r=i.useState(t?"loading":"normal"),o=W(r,2),a=o[0],c=o[1],l=i.useRef(!1),d=a==="error";i.useEffect(function(){var p=!0;return Us(e).then(function(g){!g&&p&&c("error")}),function(){p=!1}},[e]),i.useEffect(function(){t&&!l.current?c("loading"):d&&c("normal")},[e]);var h=function(){c("normal")},u=function(g){l.current=!1,a==="loading"&&g!==null&&g!==void 0&&g.complete&&(g.naturalWidth||g.naturalHeight)&&(l.current=!0,h())},m=d&&s?{src:s}:{onLoad:h,src:e};return[u,m,a]}function nt(n,e){var t=n.x-e.x,s=n.y-e.y;return Math.hypot(t,s)}function qs(n,e,t,s){var r=nt(n,t),o=nt(e,s);if(r===0&&o===0)return[n.x,n.y];var a=r/(r+o),c=n.x+a*(e.x-n.x),l=n.y+a*(e.y-n.y);return[c,l]}function Ys(n,e,t,s,r,o,a){var c=r.rotate,l=r.scale,d=r.x,h=r.y,u=i.useState(!1),m=W(u,2),p=m[0],g=m[1],v=i.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),b=function(y){v.current=A(A({},v.current),y)},w=function(y){if(e){y.stopPropagation(),g(!0);var N=y.touches,C=N===void 0?[]:N;C.length>1?b({point1:{x:C[0].clientX,y:C[0].clientY},point2:{x:C[1].clientX,y:C[1].clientY},eventType:"touchZoom"}):b({point1:{x:C[0].clientX-d,y:C[0].clientY-h},eventType:"move"})}},_=function(y){var N=y.touches,C=N===void 0?[]:N,x=v.current,T=x.point1,M=x.point2,E=x.eventType;if(C.length>1&&E==="touchZoom"){var P={x:C[0].clientX,y:C[0].clientY},k={x:C[1].clientX,y:C[1].clientY},I=qs(T,M,P,k),D=W(I,2),K=D[0],U=D[1],Z=nt(P,k)/nt(T,M);a(Z,"touchZoom",K,U,!0),b({point1:P,point2:k,eventType:"touchZoom"})}else E==="move"&&(o({x:C[0].clientX-T.x,y:C[0].clientY-T.y},"move"),b({eventType:"move"}))},S=function(){if(t){if(p&&g(!1),b({eventType:"none"}),s>l)return o({x:0,y:0,scale:s},"touchZoom");var y=n.current.offsetWidth*l,N=n.current.offsetHeight*l,C=n.current.getBoundingClientRect(),x=C.left,T=C.top,M=c%180!==0,E=_n(M?N:y,M?y:N,x,T);E&&o(A({},E),"dragRebound")}};return i.useEffect(function(){var R;return t&&e&&(R=Ae(window,"touchmove",function(y){return y.preventDefault()},{passive:!1})),function(){var y;(y=R)===null||y===void 0||y.remove()}},[t,e]),{isTouching:p,onTouchStart:w,onTouchMove:_,onTouchEnd:S}}var Xs=["fallback","src","imgRef"],Ws=["prefixCls","src","alt","imageInfo","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],Ks=function(e){var t=e.fallback,s=e.src,r=e.imgRef,o=je(e,Xs),a=Sn({src:s,fallback:t}),c=W(a,2),l=c[0],d=c[1];return Pe.createElement("img",j({ref:function(u){r.current=u,l(u)}},o,d))},Rn=function(e){var t=e.prefixCls,s=e.src,r=e.alt,o=e.imageInfo,a=e.fallback,c=e.movable,l=c===void 0?!0:c,d=e.onClose,h=e.visible,u=e.icons,m=u===void 0?{}:u,p=e.rootClassName,g=e.closeIcon,v=e.getContainer,b=e.current,w=b===void 0?0:b,_=e.count,S=_===void 0?1:_,R=e.countRender,y=e.scaleStep,N=y===void 0?.5:y,C=e.minScale,x=C===void 0?1:C,T=e.maxScale,M=T===void 0?50:T,E=e.transitionName,P=E===void 0?"zoom":E,k=e.maskTransitionName,I=k===void 0?"fade":k,D=e.imageRender,K=e.imgCommonProps,U=e.toolbarRender,Z=e.onTransform,z=e.onChange,q=je(e,Ws),G=i.useRef(),ee=i.useContext(Ve),Q=ee&&S>1,ce=ee&&S>=1,ne=i.useState(!0),L=W(ne,2),se=L[0],le=L[1],ie=Fs(G,x,M,Z),B=ie.transform,me=ie.resetTransform,J=ie.updateTransform,ae=ie.dispatchZoomChange,pe=Vs(G,l,h,N,B,J,ae),be=pe.isMoving,F=pe.onMouseDown,H=pe.onWheel,V=Ys(G,l,h,x,B,J,ae),te=V.isTouching,Y=V.onTouchStart,Re=V.onTouchMove,ke=V.onTouchEnd,Ce=B.rotate,Ee=B.scale,lt=re(ye({},"".concat(t,"-moving"),be));i.useEffect(function(){se||le(!0)},[se]);var ut=function(){me("close")},dt=function(){ae(Le+N,"zoomIn")},Te=function(){ae(Le/(Le+N),"zoomOut")},Me=function(){J({rotate:Ce+90},"rotateRight")},Ue=function(){J({rotate:Ce-90},"rotateLeft")},qe=function(){J({flipX:!B.flipX},"flipX")},Ye=function(){J({flipY:!B.flipY},"flipY")},Qn=function(){me("reset")},ht=function(Ne){var Xe=w+Ne;!Number.isInteger(Xe)||Xe<0||Xe>S-1||(le(!1),me(Ne<0?"prev":"next"),z?.(Xe,w))},Jn=function(Ne){!h||!Q||(Ne.keyCode===wt.LEFT?ht(-1):Ne.keyCode===wt.RIGHT&&ht(1))},es=function(Ne){h&&(Ee!==1?J({x:0,y:0,scale:1},"doubleClick"):ae(Le+N,"doubleClick",Ne.clientX,Ne.clientY))};i.useEffect(function(){var ue=Ae(window,"keydown",Jn,!1);return function(){ue.remove()}},[h,Q,w]);var Vt=Pe.createElement(Ks,j({},K,{width:e.width,height:e.height,imgRef:G,className:"".concat(t,"-img"),alt:r,style:{transform:"translate3d(".concat(B.x,"px, ").concat(B.y,"px, 0) scale3d(").concat(B.flipX?"-":"").concat(Ee,", ").concat(B.flipY?"-":"").concat(Ee,", 1) rotate(").concat(Ce,"deg)"),transitionDuration:(!se||te)&&"0s"},fallback:a,src:s,onWheel:H,onMouseDown:F,onDoubleClick:es,onTouchStart:Y,onTouchMove:Re,onTouchEnd:ke,onTouchCancel:ke})),Ut=A({url:s,alt:r},o);return Pe.createElement(Pe.Fragment,null,Pe.createElement(vs,j({transitionName:P,maskTransitionName:I,closable:!1,keyboard:!0,prefixCls:t,onClose:d,visible:h,classNames:{wrapper:lt},rootClassName:p,getContainer:v},q,{afterClose:ut}),Pe.createElement("div",{className:"".concat(t,"-img-wrapper")},D?D(Vt,A({transform:B,image:Ut},ee?{current:w}:{})):Vt)),Pe.createElement(zs,{visible:h,transform:B,maskTransitionName:I,closeIcon:g,getContainer:v,prefixCls:t,rootClassName:p,icons:m,countRender:R,showSwitch:Q,showProgress:ce,current:w,count:S,scale:Ee,minScale:x,maxScale:M,toolbarRender:U,onActive:ht,onZoomIn:dt,onZoomOut:Te,onRotateRight:Me,onRotateLeft:Ue,onFlipX:qe,onFlipY:Ye,onClose:d,onReset:Qn,zIndex:q.zIndex!==void 0?q.zIndex+1:void 0,image:Ut}))},bt=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];function Zs(n){var e=i.useState({}),t=W(e,2),s=t[0],r=t[1],o=i.useCallback(function(c,l){return r(function(d){return A(A({},d),{},ye({},c,l))}),function(){r(function(d){var h=A({},d);return delete h[c],h})}},[]),a=i.useMemo(function(){return n?n.map(function(c){if(typeof c=="string")return{data:{src:c}};var l={};return Object.keys(c).forEach(function(d){["src"].concat(un(bt)).includes(d)&&(l[d]=c[d])}),{data:l}}):Object.keys(s).reduce(function(c,l){var d=s[l],h=d.canPreview,u=d.data;return h&&c.push({data:u,id:l}),c},[])},[n,s]);return[a,o,!!n]}var Gs=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],Qs=["src"],Js=function(e){var t,s=e.previewPrefixCls,r=s===void 0?"rc-image-preview":s,o=e.children,a=e.icons,c=a===void 0?{}:a,l=e.items,d=e.preview,h=e.fallback,u=dn(d)==="object"?d:{},m=u.visible,p=u.onVisibleChange,g=u.getContainer,v=u.current,b=u.movable,w=u.minScale,_=u.maxScale,S=u.countRender,R=u.closeIcon,y=u.onChange,N=u.onTransform,C=u.toolbarRender,x=u.imageRender,T=je(u,Gs),M=Zs(l),E=W(M,3),P=E[0],k=E[1],I=E[2],D=xt(0,{value:v}),K=W(D,2),U=K[0],Z=K[1],z=i.useState(!1),q=W(z,2),G=q[0],ee=q[1],Q=((t=P[U])===null||t===void 0?void 0:t.data)||{},ce=Q.src,ne=je(Q,Qs),L=xt(!!m,{value:m,onChange:function(te,Y){p?.(te,Y,U)}}),se=W(L,2),le=se[0],ie=se[1],B=i.useState(null),me=W(B,2),J=me[0],ae=me[1],pe=i.useCallback(function(V,te,Y,Re){var ke=I?P.findIndex(function(Ce){return Ce.data.src===te}):P.findIndex(function(Ce){return Ce.id===V});Z(ke<0?0:ke),ie(!0),ae({x:Y,y:Re}),ee(!0)},[P,I]);i.useEffect(function(){le?G||Z(0):ee(!1)},[le]);var be=function(te,Y){Z(te),y?.(te,Y)},F=function(){ie(!1),ae(null)},H=i.useMemo(function(){return{register:k,onPreview:pe}},[k,pe]);return i.createElement(Ve.Provider,{value:H},o,i.createElement(Rn,j({"aria-hidden":!le,movable:b,visible:le,prefixCls:r,closeIcon:R,onClose:F,mousePosition:J,imgCommonProps:ne,src:ce,fallback:h,icons:c,minScale:w,maxScale:_,getContainer:g,current:U,count:P.length,countRender:S,onTransform:N,toolbarRender:C,imageRender:x,onChange:be},T)))},Gt=0;function er(n,e){var t=i.useState(function(){return Gt+=1,String(Gt)}),s=W(t,1),r=s[0],o=i.useContext(Ve),a={data:e,canPreview:n};return i.useEffect(function(){if(o)return o.register(r,a)},[]),i.useEffect(function(){o&&o.register(r,a)},[n,e]),r}var tr=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],nr=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],At=function(e){var t=e.src,s=e.alt,r=e.onPreviewClose,o=e.prefixCls,a=o===void 0?"rc-image":o,c=e.previewPrefixCls,l=c===void 0?"".concat(a,"-preview"):c,d=e.placeholder,h=e.fallback,u=e.width,m=e.height,p=e.style,g=e.preview,v=g===void 0?!0:g,b=e.className,w=e.onClick,_=e.onError,S=e.wrapperClassName,R=e.wrapperStyle,y=e.rootClassName,N=je(e,tr),C=d&&d!==!0,x=dn(v)==="object"?v:{},T=x.src,M=x.visible,E=M===void 0?void 0:M,P=x.onVisibleChange,k=P===void 0?r:P,I=x.getContainer,D=I===void 0?void 0:I,K=x.mask,U=x.maskClassName,Z=x.movable,z=x.icons,q=x.scaleStep,G=x.minScale,ee=x.maxScale,Q=x.imageRender,ce=x.toolbarRender,ne=je(x,nr),L=T??t,se=xt(!!E,{value:E,onChange:k}),le=W(se,2),ie=le[0],B=le[1],me=Sn({src:t,isCustomPlaceholder:C,fallback:h}),J=W(me,3),ae=J[0],pe=J[1],be=J[2],F=i.useState(null),H=W(F,2),V=H[0],te=H[1],Y=i.useContext(Ve),Re=!!v,ke=function(){B(!1),te(null)},Ce=re(a,S,y,ye({},"".concat(a,"-error"),be==="error")),Ee=i.useMemo(function(){var Te={};return bt.forEach(function(Me){e[Me]!==void 0&&(Te[Me]=e[Me])}),Te},bt.map(function(Te){return e[Te]})),lt=i.useMemo(function(){return A(A({},Ee),{},{src:L})},[L,Ee]),ut=er(Re,lt),dt=function(Me){var Ue=Ds(Me.target),qe=Ue.left,Ye=Ue.top;Y?Y.onPreview(ut,L,qe,Ye):(te({x:qe,y:Ye}),B(!0)),w?.(Me)};return i.createElement(i.Fragment,null,i.createElement("div",j({},N,{className:Ce,onClick:Re?dt:w,style:A({width:u,height:m},R)}),i.createElement("img",j({},Ee,{className:re("".concat(a,"-img"),ye({},"".concat(a,"-img-placeholder"),d===!0),b),style:A({height:m},p),ref:ae},pe,{width:u,height:m,onError:_})),be==="loading"&&i.createElement("div",{"aria-hidden":"true",className:"".concat(a,"-placeholder")},d),K&&Re&&i.createElement("div",{className:re("".concat(a,"-mask"),U),style:{display:p?.display==="none"?"none":void 0}},K)),!Y&&Re&&i.createElement(Rn,j({"aria-hidden":!ie,visible:ie,prefixCls:l,onClose:ke,mousePosition:V,src:L,alt:s,imageInfo:{width:u,height:m},fallback:h,getContainer:D,icons:z,movable:Z,scaleStep:q,minScale:G,maxScale:ee,rootClassName:y,imageRender:Q,imgCommonProps:Ee,toolbarRender:ce},ne)))};At.PreviewGroup=Js;var sr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M672 418H144c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H188V494h440v326z"}},{tag:"path",attrs:{d:"M819.3 328.5c-78.8-100.7-196-153.6-314.6-154.2l-.2-64c0-6.5-7.6-10.1-12.6-6.1l-128 101c-4 3.1-3.9 9.1 0 12.3L492 318.6c5.1 4 12.7.4 12.6-6.1v-63.9c12.9.1 25.9.9 38.8 2.5 42.1 5.2 82.1 18.2 119 38.7 38.1 21.2 71.2 49.7 98.4 84.3 27.1 34.7 46.7 73.7 58.1 115.8a325.95 325.95 0 016.5 140.9h74.9c14.8-103.6-11.3-213-81-302.3z"}}]},name:"rotate-left",theme:"outlined"},rr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:sr}))},or=i.forwardRef(rr),ir={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M480.5 251.2c13-1.6 25.9-2.4 38.8-2.5v63.9c0 6.5 7.5 10.1 12.6 6.1L660 217.6c4-3.2 4-9.2 0-12.3l-128-101c-5.1-4-12.6-.4-12.6 6.1l-.2 64c-118.6.5-235.8 53.4-314.6 154.2A399.75 399.75 0 00123.5 631h74.9c-.9-5.3-1.7-10.7-2.4-16.1-5.1-42.1-2.1-84.1 8.9-124.8 11.4-42.2 31-81.1 58.1-115.8 27.2-34.7 60.3-63.2 98.4-84.3 37-20.6 76.9-33.6 119.1-38.8z"}},{tag:"path",attrs:{d:"M880 418H352c-17.7 0-32 14.3-32 32v414c0 17.7 14.3 32 32 32h528c17.7 0 32-14.3 32-32V450c0-17.7-14.3-32-32-32zm-44 402H396V494h440v326z"}}]},name:"rotate-right",theme:"outlined"},ar=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:ir}))},cr=i.forwardRef(ar),lr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},ur=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:lr}))},Qt=i.forwardRef(ur),dr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-in",theme:"outlined"},hr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:dr}))},fr=i.forwardRef(hr),mr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"}}]},name:"zoom-out",theme:"outlined"},pr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:mr}))},gr=i.forwardRef(pr);const Ct=n=>({position:n||"absolute",inset:0}),vr=n=>{const{iconCls:e,motionDurationSlow:t,paddingXXS:s,marginXXS:r,prefixCls:o,colorTextLightSolid:a}=n;return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:a,background:new Ie("#000").setA(.5).toRgbString(),cursor:"pointer",opacity:0,transition:`opacity ${t}`,[`.${o}-mask-info`]:Object.assign(Object.assign({},os),{padding:`0 ${hn(s)}`,[e]:{marginInlineEnd:r,svg:{verticalAlign:"baseline"}}})}},yr=n=>{const{previewCls:e,modalMaskBg:t,paddingSM:s,marginXL:r,margin:o,paddingLG:a,previewOperationColorDisabled:c,previewOperationHoverColor:l,motionDurationSlow:d,iconCls:h,colorTextLightSolid:u}=n,m=new Ie(t).setA(.1),p=m.clone().setA(.2);return{[`${e}-footer`]:{position:"fixed",bottom:r,left:{_skip_check_:!0,value:"50%"},display:"flex",flexDirection:"column",alignItems:"center",color:n.previewOperationColor,transform:"translateX(-50%)"},[`${e}-progress`]:{marginBottom:o},[`${e}-close`]:{position:"fixed",top:r,right:{_skip_check_:!0,value:r},display:"flex",color:u,backgroundColor:m.toRgbString(),borderRadius:"50%",padding:s,outline:0,border:0,cursor:"pointer",transition:`all ${d}`,"&:hover":{backgroundColor:p.toRgbString()},[`& > ${h}`]:{fontSize:n.previewOperationSize}},[`${e}-operations`]:{display:"flex",alignItems:"center",padding:`0 ${hn(a)}`,backgroundColor:m.toRgbString(),borderRadius:100,"&-operation":{marginInlineStart:s,padding:s,cursor:"pointer",transition:`all ${d}`,userSelect:"none",[`&:not(${e}-operations-operation-disabled):hover > ${h}`]:{color:l},"&-disabled":{color:c,cursor:"not-allowed"},"&:first-of-type":{marginInlineStart:0},[`& > ${h}`]:{fontSize:n.previewOperationSize}}}}},wr=n=>{const{modalMaskBg:e,iconCls:t,previewOperationColorDisabled:s,previewCls:r,zIndexPopup:o,motionDurationSlow:a}=n,c=new Ie(e).setA(.1),l=c.clone().setA(.2);return{[`${r}-switch-left, ${r}-switch-right`]:{position:"fixed",insetBlockStart:"50%",zIndex:n.calc(o).add(1).equal(),display:"flex",alignItems:"center",justifyContent:"center",width:n.imagePreviewSwitchSize,height:n.imagePreviewSwitchSize,marginTop:n.calc(n.imagePreviewSwitchSize).mul(-1).div(2).equal(),color:n.previewOperationColor,background:c.toRgbString(),borderRadius:"50%",transform:"translateY(-50%)",cursor:"pointer",transition:`all ${a}`,userSelect:"none","&:hover":{background:l.toRgbString()},"&-disabled":{"&, &:hover":{color:s,background:"transparent",cursor:"not-allowed",[`> ${t}`]:{cursor:"not-allowed"}}},[`> ${t}`]:{fontSize:n.previewOperationSize}},[`${r}-switch-left`]:{insetInlineStart:n.marginSM},[`${r}-switch-right`]:{insetInlineEnd:n.marginSM}}},xr=n=>{const{motionEaseOut:e,previewCls:t,motionDurationSlow:s,componentCls:r}=n;return[{[`${r}-preview-root`]:{[t]:{height:"100%",textAlign:"center",pointerEvents:"none"},[`${t}-body`]:Object.assign(Object.assign({},Ct()),{overflow:"hidden"}),[`${t}-img`]:{maxWidth:"100%",maxHeight:"70%",verticalAlign:"middle",transform:"scale3d(1, 1, 1)",cursor:"grab",transition:`transform ${s} ${e} 0s`,userSelect:"none","&-wrapper":Object.assign(Object.assign({},Ct()),{transition:`transform ${s} ${e} 0s`,display:"flex",justifyContent:"center",alignItems:"center","& > *":{pointerEvents:"auto"},"&::before":{display:"inline-block",width:1,height:"50%",marginInlineEnd:-1,content:'""'}})},[`${t}-moving`]:{[`${t}-preview-img`]:{cursor:"grabbing","&-wrapper":{transitionDuration:"0s"}}}}},{[`${r}-preview-root`]:{[`${t}-wrap`]:{zIndex:n.zIndexPopup}}},{[`${r}-preview-operations-wrapper`]:{position:"fixed",zIndex:n.calc(n.zIndexPopup).add(1).equal()},"&":[yr(n),wr(n)]}]},br=n=>{const{componentCls:e}=n;return{[e]:{position:"relative",display:"inline-block",[`${e}-img`]:{width:"100%",height:"auto",verticalAlign:"middle"},[`${e}-img-placeholder`]:{backgroundColor:n.colorBgContainerDisabled,backgroundImage:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQuNSAyLjVoLTEzQS41LjUgMCAwIDAgMSAzdjEwYS41LjUgMCAwIDAgLjUuNWgxM2EuNS41IDAgMCAwIC41LS41VjNhLjUuNSAwIDAgMC0uNS0uNXpNNS4yODEgNC43NWExIDEgMCAwIDEgMCAyIDEgMSAwIDAgMSAwLTJ6bTguMDMgNi44M2EuMTI3LjEyNyAwIDAgMS0uMDgxLjAzSDIuNzY5YS4xMjUuMTI1IDAgMCAxLS4wOTYtLjIwN2wyLjY2MS0zLjE1NmEuMTI2LjEyNiAwIDAgMSAuMTc3LS4wMTZsLjAxNi4wMTZMNy4wOCAxMC4wOWwyLjQ3LTIuOTNhLjEyNi4xMjYgMCAwIDEgLjE3Ny0uMDE2bC4wMTUuMDE2IDMuNTg4IDQuMjQ0YS4xMjcuMTI3IDAgMCAxLS4wMi4xNzV6IiBmaWxsPSIjOEM4QzhDIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L3N2Zz4=')",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"30%"},[`${e}-mask`]:Object.assign({},vr(n)),[`${e}-mask:hover`]:{opacity:1},[`${e}-placeholder`]:Object.assign({},Ct())}}},Cr=n=>{const{previewCls:e}=n;return{[`${e}-root`]:Rs(n,"zoom"),"&":ws(n,!0)}},Er=n=>({zIndexPopup:n.zIndexPopupBase+80,previewOperationColor:new Ie(n.colorTextLightSolid).setA(.65).toRgbString(),previewOperationHoverColor:new Ie(n.colorTextLightSolid).setA(.85).toRgbString(),previewOperationColorDisabled:new Ie(n.colorTextLightSolid).setA(.25).toRgbString(),previewOperationSize:n.fontSizeIcon*1.5}),Tn=rs("Image",n=>{const e=`${n.componentCls}-preview`,t=Yt(n,{previewCls:e,modalMaskBg:new Ie("#000").setA(.45).toRgbString(),imagePreviewSwitchSize:n.controlHeightLG});return[br(t),xr(t),ys(Yt(t,{componentCls:e})),Cr(t)]},Er);var _r=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const Mn={rotateLeft:i.createElement(or,null),rotateRight:i.createElement(cr,null),zoomIn:i.createElement(fr,null),zoomOut:i.createElement(gr,null),close:i.createElement(Ts,null),left:i.createElement(yt,null),right:i.createElement(vt,null),flipX:i.createElement(Qt,null),flipY:i.createElement(Qt,{rotate:90})},Sr=n=>{var{previewPrefixCls:e,preview:t}=n,s=_r(n,["previewPrefixCls","preview"]);const{getPrefixCls:r,direction:o}=i.useContext(kt),a=r("image",e),c=`${a}-preview`,l=r(),d=yn(a),[h,u,m]=Tn(a,d),[p]=wn("ImagePreview",typeof t=="object"?t.zIndex:void 0),g=i.useMemo(()=>Object.assign(Object.assign({},Mn),{left:o==="rtl"?i.createElement(vt,null):i.createElement(yt,null),right:o==="rtl"?i.createElement(yt,null):i.createElement(vt,null)}),[o]),v=i.useMemo(()=>{var b;if(t===!1)return t;const w=typeof t=="object"?t:{},_=re(u,m,d,(b=w.rootClassName)!==null&&b!==void 0?b:"");return Object.assign(Object.assign({},w),{transitionName:tt(l,"zoom",w.transitionName),maskTransitionName:tt(l,"fade",w.maskTransitionName),rootClassName:_,zIndex:p})},[t]);return h(i.createElement(At.PreviewGroup,Object.assign({preview:v,previewPrefixCls:c,icons:g},s)))};var Jt=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const Lt=n=>{const{prefixCls:e,preview:t,className:s,rootClassName:r,style:o}=n,a=Jt(n,["prefixCls","preview","className","rootClassName","style"]),{getPrefixCls:c,getPopupContainer:l,className:d,style:h,preview:u}=fn("image"),[m]=Ms("Image"),p=c("image",e),g=c(),v=yn(p),[b,w,_]=Tn(p,v),S=re(r,w,_,v),R=re(s,w,d),[y]=wn("ImagePreview",typeof t=="object"?t.zIndex:void 0),N=i.useMemo(()=>{if(t===!1)return t;const x=typeof t=="object"?t:{},{getContainer:T,closeIcon:M,rootClassName:E,destroyOnClose:P,destroyOnHidden:k}=x,I=Jt(x,["getContainer","closeIcon","rootClassName","destroyOnClose","destroyOnHidden"]);return Object.assign(Object.assign({mask:i.createElement("div",{className:`${p}-mask-info`},i.createElement(Ns,null),m?.preview),icons:Mn},I),{destroyOnClose:k??P,rootClassName:re(S,E),getContainer:T??l,transitionName:tt(g,"zoom",x.transitionName),maskTransitionName:tt(g,"fade",x.maskTransitionName),zIndex:y,closeIcon:M??u?.closeIcon})},[t,m,u?.closeIcon]),C=Object.assign(Object.assign({},h),o);return b(i.createElement(At,Object.assign({prefixCls:p,preview:N,rootClassName:S,className:R,style:C},a)))};Lt.PreviewGroup=Sr;function Rr(n,e,t){return typeof t=="boolean"?t:n.length?!0:Os(e).some(r=>r.type===mn)}var Nn=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};function ot({suffixCls:n,tagName:e,displayName:t}){return s=>i.forwardRef((o,a)=>i.createElement(s,Object.assign({ref:a,suffixCls:n,tagName:e},o)))}const jt=i.forwardRef((n,e)=>{const{prefixCls:t,suffixCls:s,className:r,tagName:o}=n,a=Nn(n,["prefixCls","suffixCls","className","tagName"]),{getPrefixCls:c}=i.useContext(kt),l=c("layout",t),[d,h,u]=pn(l),m=s?`${l}-${s}`:l;return d(i.createElement(o,Object.assign({className:re(t||m,r,h,u),ref:e},a)))}),Tr=i.forwardRef((n,e)=>{const{direction:t}=i.useContext(kt),[s,r]=i.useState([]),{prefixCls:o,className:a,rootClassName:c,children:l,hasSider:d,tagName:h,style:u}=n,m=Nn(n,["prefixCls","className","rootClassName","children","hasSider","tagName","style"]),p=ks(m,["suffixCls"]),{getPrefixCls:g,className:v,style:b}=fn("layout"),w=g("layout",o),_=Rr(s,l,d),[S,R,y]=pn(w),N=re(w,{[`${w}-has-sider`]:_,[`${w}-rtl`]:t==="rtl"},v,a,c,R,y),C=i.useMemo(()=>({siderHook:{addSider:x=>{r(T=>[].concat(un(T),[x]))},removeSider:x=>{r(T=>T.filter(M=>M!==x))}}}),[]);return S(i.createElement(xs.Provider,{value:C},i.createElement(h,Object.assign({ref:e,className:N,style:Object.assign(Object.assign({},b),u)},p),l)))}),Mr=ot({tagName:"div",displayName:"Layout"})(Tr),Nr=ot({suffixCls:"header",tagName:"header",displayName:"Header"})(jt),Or=ot({suffixCls:"footer",tagName:"footer",displayName:"Footer"})(jt),kr=ot({suffixCls:"content",tagName:"main",displayName:"Content"})(jt),_e=Mr;_e.Header=Nr;_e.Footer=Or;_e.Content=kr;_e.Sider=mn;_e._InternalSiderContext=bs;var Pr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},Ir=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Pr}))},Ar=i.forwardRef(Ir),Lr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},jr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Lr}))},Br=i.forwardRef(jr),$r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1zM512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92V232z"}}]},name:"audio",theme:"outlined"},Dr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:$r}))},zr=i.forwardRef(Dr),Fr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},Hr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Fr}))},en=i.forwardRef(Hr),Vr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"},Ur=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Vr}))},qr=i.forwardRef(Ur),Yr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"}}]},name:"pause",theme:"outlined"},Xr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Yr}))},Wr=i.forwardRef(Xr),Kr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},Zr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Kr}))},Gr=i.forwardRef(Zr),Qr={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},Jr=function(e,t){return i.createElement(oe,j({},e,{ref:t,icon:Qr}))},tn=i.forwardRef(Jr),eo=class extends is{constructor(n,e){super(n,e)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(n){super.setOptions({...n,behavior:Xt()})}getOptimisticResult(n){return n.behavior=Xt(),super.getOptimisticResult(n)}fetchNextPage(n){return this.fetch({...n,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(n){return this.fetch({...n,meta:{fetchMore:{direction:"backward"}}})}createResult(n,e){const{state:t}=n,s=super.createResult(n,e),{isFetching:r,isRefetching:o,isError:a,isRefetchError:c}=s,l=t.fetchMeta?.fetchMore?.direction,d=a&&l==="forward",h=r&&l==="forward",u=a&&l==="backward",m=r&&l==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:cs(e,t.data),hasPreviousPage:as(e,t.data),isFetchNextPageError:d,isFetchingNextPage:h,isFetchPreviousPageError:u,isFetchingPreviousPage:m,isRefetchError:c&&!d&&!u,isRefetching:o&&!h&&!m}}};function to(n,e){return ls(n,eo)}const no=({id:n})=>{const{error:e,data:t,isLoading:s}=us({queryKey:["chats-details",n],queryFn:async()=>await Cs.getChatById(n)});return{error:e?e.message:null,data:t,loading:s}},so=({placeholder:n,className:e,route:t})=>{const s=ds(),r=()=>{s(t||-1)};return f.jsx(ve,{type:"primary",onClick:r,className:e,style:{cursor:"pointer"},children:n||"Geri Qayıt"})},ro=i.memo(so),{Header:oo}=_e,{Text:io}=gn,ao=({chatId:n})=>{const{loading:e,error:t,data:s}=no({id:n});return e?f.jsx("div",{children:"loading..."}):t||!s?f.jsx("div",{children:"error..."}):f.jsxs(oo,{className:"flex items-center justify-between p-4 bg-gray-800 border-b border-gray-700",children:[f.jsx(ro,{placeholder:f.jsx(Br,{}),route:"/"}),f.jsx(io,{className:"text-xl",children:s.name})]})},co=i.memo(ao);var $e=(n=>(n.TEXT="text",n.MEDIA="media",n.VOICE="voice",n))($e||{});const On=i.createContext(null),lo=i.memo(({children:n,value:e})=>f.jsx(On.Provider,{value:e,children:n})),kn=()=>{const n=i.useContext(On);if(!n)throw new Error("useGetChatMessagesContract must be used within a GetChatMessagesContractProvider");return n},Pn=i.createContext(null),uo=i.memo(({children:n,...e})=>f.jsx(Pn.Provider,{value:e,children:n})),In=()=>{const n=i.useContext(Pn);if(!n)throw new Error("useMeContract must be used within a MeContractProvider");return n};var he=(n=>(n.IMAGE="image",n.VIDEO="video",n.DOCUMENT="document",n.AUDIO="audio",n.VOICE="voice",n))(he||{});const ho=({media:n})=>{const e=s=>{try{const o=new URL(s).pathname.split("/");return decodeURIComponent(o[o.length-1])}catch(r){return console.log("Error parsing URL:",r),"file"}},t=`https://api.silent-talk.online${n.url}`;switch(n.type){case he.IMAGE:return f.jsx(Lt,{src:t,alt:"image content",className:"max-w-full max-h-80 rounded-lg object-cover"});case he.VIDEO:return f.jsx("video",{src:t,controls:!0,className:"max-w-full max-h-80 rounded-lg"});case he.AUDIO:return f.jsx("audio",{src:t,controls:!0,className:"w-full"});case he.DOCUMENT:return f.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"flex items-center p-2 bg-gray-600 hover:bg-gray-500 rounded-lg",children:[f.jsx($s,{className:"mr-2 text-2xl"}),f.jsx("span",{className:"truncate",children:e(n.url)})]});default:return null}},fo=i.memo(ho),Et=n=>{const e=Math.floor(n/60),t=n%60,s=String(e).padStart(2,"0"),r=String(t).padStart(2,"0");return`${s}:${r}`},mo=({url:n})=>{const e=i.useRef(null),[t,s]=i.useState(!1),[r,o]=i.useState(0),[a,c]=i.useState(0),l=`${n}`,d=()=>{const u=e.current;u&&(t?u.pause():u.play(),s(!t))};i.useEffect(()=>{const u=e.current;if(!u)return;const m=()=>{u&&isFinite(u.duration)&&o(u.duration)},p=()=>c(u.currentTime),g=()=>s(!1);return u.addEventListener("loadedmetadata",m),u.addEventListener("durationchange",m),u.addEventListener("timeupdate",p),u.addEventListener("ended",g),u.readyState>0&&m(),()=>{u.removeEventListener("loadedmetadata",m),u.removeEventListener("durationchange",m),u.removeEventListener("timeupdate",p),u.removeEventListener("ended",g)}},[l]);const h=r>0?a/r*100:0;return f.jsxs("div",{className:"flex items-center w-full max-w-xs gap-2",children:[f.jsx("audio",{ref:e,src:l,preload:"metadata"}),f.jsx(ve,{type:"text",shape:"circle",onClick:d,icon:t?f.jsx(Wr,{}):f.jsx(Gr,{}),className:"text-2xl"}),f.jsx("div",{className:"flex-grow bg-gray-500 bg-opacity-50 h-1 rounded-full",children:f.jsx("div",{style:{width:`${h}%`},className:"bg-blue-400 h-1 rounded-full"})}),f.jsxs("span",{className:"text-xs font-mono w-20 text-right whitespace-nowrap",children:[Et(Math.floor(a))," / ",Et(Math.floor(r))]})]})},po=i.memo(mo);class go{constructor(e={}){this.handlers=new Map,this.wildcardHandlers=new Set,this.config={onError:t=>console.error(`EventBus error: ${t.message}`),maxListeners:20,...e}}on(e,t){this.validateHandler(t),this.handlers.has(e)||this.handlers.set(e,new Set);const s=this.handlers.get(e);return this.config.maxListeners&&s.size>=this.config.maxListeners&&console.warn(`Event "${String(e)}" has exceeded the maximum listeners (${this.config.maxListeners})`),s.add(t),()=>this.off(e,t)}once(e,t){const s=r=>{try{t(r)}finally{this.off(e,s)}};return this.on(e,s)}off(e,t){if(!this.handlers.has(e))return;const s=this.handlers.get(e);s.delete(t),s.size===0&&this.handlers.delete(e)}offAll(e){e?this.handlers.delete(e):(this.handlers.clear(),this.wildcardHandlers.clear())}emit(e,t){this.handlers.has(e)&&new Set(this.handlers.get(e)).forEach(r=>{try{r(t)}catch(o){this.config.onError?.(o,e,t)}}),this.wildcardHandlers.forEach(s=>{try{s(e,t)}catch(r){this.config.onError?.(r,e,t)}})}onAll(e){return this.wildcardHandlers.add(e),()=>{this.wildcardHandlers.delete(e)}}all(){return new Map(this.handlers)}validateHandler(e){if(typeof e!="function")throw new Error("Event handler must be a function")}}const Bt=n=>new go(n),nn=Bt(),An=i.createContext(null),vo=({children:n,eventBus:e,config:t})=>{const s=i.useMemo(()=>e||(t?Bt(t):nn),[e,t,nn]),r=i.useMemo(()=>({eventBus:s}),[s]);return f.jsx(An.Provider,{value:r,children:n})},yo=i.memo(vo),wo=()=>{const n=i.useContext(An);if(!n)throw new Error("useEventBusContext must be used within an EventBusProvider");return n},Ln=n=>{try{const e=wo();return n?.eventBus||e.eventBus}catch{return n?.eventBus||Bt()}},jn=(n,e,t=[],s)=>{const r=Ln(s),o=i.useRef(e);i.useEffect(()=>{o.current=e},[e,...t]),i.useEffect(()=>{const a=l=>o.current(l);return r.on(n,a)},[n,r])},xo=n=>{const e=Ln(n);return i.useCallback((t,s)=>{e.emit(t,s)},[e])},bo=({event:n,handler:e,eventBus:t})=>(jn(n,e,[],{eventBus:t}),null);i.memo(bo);const{Text:_t}=gn,Co=({message:n})=>{const e=xo();return f.jsxs("button",{onClick:()=>e(`scrollToMessage-${n.id}`,n.id),className:"mb-2 flex flex-col items-start p-2 border-l-4 border-blue-400 bg-black bg-opacity-20 rounded w-full",children:[f.jsx(_t,{className:"font-bold text-sm text-gray-300",children:n?.user?.username||"Not defined"}),f.jsx("p",{className:"text-sm text-gray-400 truncate",children:n.text?.substring(0,35)||"Медиафайл"})]})},Eo=i.memo(({item:n})=>{const{me:e}=In(),{setEditMessage:t,setReplyToMessage:s,handleDeleteMessage:r,mutationLoading:o}=kn(),c=i.useCallback(d=>e?.id===d,[e?.id])(n.user.id),l=[{key:"reply",disabled:o,label:"Ответить",onClick:()=>s(n)},{key:"delete",label:"Удалить",danger:!0,disabled:o,onClick:()=>r(n.id)},...c?[{key:"edit",disabled:o,label:"Редактировать",onClick:()=>t(n)}]:[]];return jn(`scrollToMessage-${n.id}`,d=>{const h=document.getElementById(d);h&&(h.scrollIntoView({behavior:"smooth",block:"center"}),h.classList.add("bg-yellow-300"),setTimeout(()=>{h.classList.remove("bg-yellow-300")},2e3))}),f.jsx(vn.Item,{id:n.id,className:`flex ${c?"justify-end":"justify-start"} transition-all duration-300 !p-2 rounded-lg`,style:{border:"none",paddingBottom:"1rem"},children:f.jsxs("div",{className:"flex items-start max-w-xl w-full",children:[!c&&f.jsx("div",{className:"mr-3 flex-shrink-0",children:f.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-white font-bold",children:n.user.username.charAt(0).toUpperCase()})}),f.jsxs("div",{className:`relative p-3 rounded-lg w-full ${c?"bg-blue-600 text-white":"bg-gray-700 text-gray-200"}`,children:[f.jsx("div",{className:"absolute top-1 right-1 z-10",children:f.jsx(Es,{menu:{items:l},trigger:["click"],children:f.jsx(ve,{type:"text",shape:"circle",icon:f.jsx(Ps,{className:"text-gray-400"})})})}),n.replyTo&&f.jsx(Co,{message:n.replyTo}),f.jsx(_t,{className:`font-bold ${c?"text-white":"text-gray-300"}`,children:c?"Вы":n.user.username}),n.type===$e.VOICE&&n.medias&&n?.medias?.length>0?f.jsx("div",{className:"mt-2",children:f.jsx(po,{url:`https://api.silent-talk.online${n.medias[0].url}`})}):f.jsxs(f.Fragment,{children:[n.medias&&n.medias.length>0&&f.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:n.medias.map(d=>f.jsx(fo,{media:d},d.id))}),n.text&&f.jsx("p",{className:"pr-8 whitespace-pre-wrap mt-1",children:n.text})]}),f.jsx(_t,{className:"text-xs text-gray-400 mt-2 block text-right",children:new Date(n.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),c&&f.jsx("div",{className:"ml-3 flex-shrink-0",children:f.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold",children:"Я"})})]})})}),_o=()=>{const{loading:n,hasMore:e,messages:t,chatRef:s,fetchMoreMessages:r,isFetchingMore:o}=kn(),{loading:a}=In();console.log("Messages",t);const[c,l]=i.useState(!1),d=i.useCallback(()=>{s.current&&s.current.scrollTo({top:s.current.scrollHeight,behavior:"smooth"})},[s]),h=i.useRef(null);return i.useLayoutEffect(()=>{!n&&s?.current&&(s.current.scrollTop=s.current.scrollHeight)},[n,t,s]),i.useLayoutEffect(()=>{h.current&&s.current&&(s.current.scrollTop=s.current.scrollHeight-h.current,h.current=null)},[s,t]),i.useEffect(()=>{const u=s.current,m=()=>{if(!u)return;u.scrollTop===0&&!o&&e&&(h.current=u.scrollHeight,r()),u.scrollHeight-u.scrollTop-u.clientHeight>300?l(!0):l(!1)};return u?.addEventListener("scroll",m),()=>{u?.removeEventListener("scroll",m)}},[s,r,o,e]),a||n?f.jsx("div",{className:"flex-grow p-4 flex items-center justify-center",children:"Loading..."}):f.jsxs("div",{ref:s,className:"flex-grow p-4 overflow-y-auto relative",children:[o&&f.jsx("div",{className:"flex justify-center my-2",children:f.jsx("p",{className:"text-gray-400",children:"Загрузка предыдущих сообщений..."})}),f.jsx(yo,{children:f.jsx(vn,{itemLayout:"horizontal",dataSource:t,renderItem:u=>f.jsx(Eo,{item:u},u.id)})}),c&&f.jsx(ve,{type:"primary",shape:"circle",size:"large",icon:f.jsx(Ar,{}),className:"fixed right-[26px] bottom-[90px] z-20 animate-fade-in",onClick:d})]})},So=i.memo(_o),Bn=i.createContext(null),Ro=i.memo(({children:n,value:e})=>f.jsx(Bn.Provider,{value:e,children:n})),To=()=>{const n=i.useContext(Bn);if(!n)throw new Error("useChatContract must be used within a ChatContractProvider");return n},{TextArea:sn}=Is,Mo=n=>{const e=n.type;return e.startsWith("image/")?"photo":e.startsWith("video/")?"video":e.startsWith("audio/")?"audio":"document"},No=n=>n==="photo"?he.IMAGE:n==="video"?he.VIDEO:n==="audio"?he.AUDIO:he.DOCUMENT,Oo=()=>{const n=To(),e=i.useRef(null),t=()=>{e.current?.click()},s=async o=>{if(n.mode!=="default")return;const a=o.target.files;if(!a||a.length===0)return;const l=Array.from(a).reduce((h,u)=>{const m=Mo(u);return h[m]||(h[m]=[]),h[m].push(u),h},{}),d=[];for(const h in l){const u=h,m=l[u],p=await n.handleMultipleUpload(u,m);if(p){const g=p.split(","),v=No(u);g.forEach(b=>{d.push({url:b,type:v})})}}if(d.length>0){const h=n.chatForm.getValues("medias")||[];n.chatForm.setValue("medias",[...h,...d])}e.current&&(e.current.value="")},r=o=>{switch(o.mode){case"voice":return f.jsxs("div",{className:"flex items-center justify-between w-full",children:[f.jsx(ve,{type:"primary",danger:!0,size:"large",htmlType:"button",shape:"circle",icon:f.jsx(en,{}),onClick:o.cancelRecording}),f.jsx("div",{className:"text-gray-300 font-mono mx-4",children:Et(o.recordingTimer)}),f.jsx(ve,{type:"primary",size:"large",shape:"circle",icon:f.jsx(tn,{}),onClick:o.stopRecording,loading:o.mutationLoading})]});case"edit":return f.jsxs(f.Fragment,{children:[f.jsx(Kt,{name:"text",control:o.chatForm.control,render:({field:a})=>f.jsx(sn,{...a,size:"large",autoSize:{minRows:1,maxRows:4},style:{resize:"none"},placeholder:"Редактировать сообщение...",className:"flex-grow mr-4",disabled:o.mutationLoading,autoFocus:!0})}),f.jsx(ve,{type:"primary",size:"large",icon:f.jsx(_s,{}),htmlType:"submit",loading:o.mutationLoading})]});case"default":{const{chatForm:a}=o,c=a.watch("text"),l=a.watch("medias"),d=c&&c.trim().length>0,h=l&&l.length>0,u=d||h,m=u?f.jsx(tn,{}):f.jsx(zr,{});return f.jsxs("div",{className:"flex flex-col w-full",children:[l&&l.length>0&&f.jsx("div",{className:"flex space-x-2 mb-2 overflow-x-auto",children:l.map((p,g)=>f.jsxs("div",{className:"relative",children:[p.type===he.IMAGE?f.jsx(Lt,{src:`https://api.silent-talk.online${p.url}`,alt:`attachment-${g}`,className:"h-16 w-16 object-cover rounded"}):f.jsx("div",{className:"h-16 w-16 flex items-center justify-center bg-gray-700 rounded",children:f.jsx("span",{className:"text-sm text-gray-300",children:p.type.charAt(0).toUpperCase()+p.type.slice(1)})}),f.jsx(ve,{type:"text",shape:"circle",icon:f.jsx(en,{}),size:"small",className:"absolute -top-2 -right-2 bg-red-600 text-white",onClick:()=>{const v=l.filter((b,w)=>w!==g);a.setValue("medias",v)}})]},g))}),f.jsxs("div",{className:"flex items-center w-full justify-between",children:[f.jsx("input",{type:"file",multiple:!0,ref:e,onChange:s,style:{display:"none"}}),f.jsx(ve,{size:"large",icon:f.jsx(qr,{}),onClick:t,className:"mr-4",disabled:o.mutationLoading}),f.jsx(Kt,{name:"text",control:a.control,render:({field:p})=>f.jsx(sn,{...p,autoSize:{minRows:1,maxRows:4},style:{resize:"none"},size:"large",placeholder:"Напишите сообщение...",className:"flex-grow mr-4",disabled:o.mutationLoading})}),f.jsx(ve,{type:"primary",size:"large",icon:m,loading:o.mutationLoading,htmlType:u?"submit":"button",onClick:u?void 0:o.startRecording})]})]})}default:return null}};return f.jsxs("div",{className:"p-4 bg-gray-800 border-t border-gray-700",children:[n.replyToMessage&&f.jsx(Wt,{message:`Ответ на сообщение: ${n.replyToMessage.type===$e.TEXT?`${n.replyToMessage.text?.substring(0,50)||"Медиафайл"}...`:"Голосове сообщение"}`,type:"info",closable:!0,onClose:()=>n.setReplyToMessage(null),className:"mb-2"}),n.mode==="edit"&&n.editMessage&&f.jsx(Wt,{message:"Редактирование сообщения...",type:"warning",closable:!0,onClose:n.cancelEdit,className:"mb-2"}),f.jsx("form",{onSubmit:n.mode!=="voice"?o=>{o.preventDefault(),n.chatForm.setValue("type",$e.TEXT),n.handleSubmit(o)}:o=>o.preventDefault(),className:"flex items-center",children:r(n)})]})},ko=i.memo(Oo),xe=Object.create(null);xe.open="0";xe.close="1";xe.ping="2";xe.pong="3";xe.message="4";xe.upgrade="5";xe.noop="6";const Ge=Object.create(null);Object.keys(xe).forEach(n=>{Ge[xe[n]]=n});const St={type:"error",data:"parser error"},$n=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Dn=typeof ArrayBuffer=="function",zn=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,$t=({type:n,data:e},t,s)=>$n&&e instanceof Blob?t?s(e):rn(e,s):Dn&&(e instanceof ArrayBuffer||zn(e))?t?s(e):rn(new Blob([e]),s):s(xe[n]+(e||"")),rn=(n,e)=>{const t=new FileReader;return t.onload=function(){const s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(n)};function on(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let ft;function Po(n,e){if($n&&n.data instanceof Blob)return n.data.arrayBuffer().then(on).then(e);if(Dn&&(n.data instanceof ArrayBuffer||zn(n.data)))return e(on(n.data));$t(n,!1,t=>{ft||(ft=new TextEncoder),e(ft.encode(t))})}const an="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",He=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<an.length;n++)He[an.charCodeAt(n)]=n;const Io=n=>{let e=n.length*.75,t=n.length,s,r=0,o,a,c,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const d=new ArrayBuffer(e),h=new Uint8Array(d);for(s=0;s<t;s+=4)o=He[n.charCodeAt(s)],a=He[n.charCodeAt(s+1)],c=He[n.charCodeAt(s+2)],l=He[n.charCodeAt(s+3)],h[r++]=o<<2|a>>4,h[r++]=(a&15)<<4|c>>2,h[r++]=(c&3)<<6|l&63;return d},Ao=typeof ArrayBuffer=="function",Dt=(n,e)=>{if(typeof n!="string")return{type:"message",data:Fn(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:Lo(n.substring(1),e)}:Ge[t]?n.length>1?{type:Ge[t],data:n.substring(1)}:{type:Ge[t]}:St},Lo=(n,e)=>{if(Ao){const t=Io(n);return Fn(t,e)}else return{base64:!0,data:n}},Fn=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},Hn="",jo=(n,e)=>{const t=n.length,s=new Array(t);let r=0;n.forEach((o,a)=>{$t(o,!1,c=>{s[a]=c,++r===t&&e(s.join(Hn))})})},Bo=(n,e)=>{const t=n.split(Hn),s=[];for(let r=0;r<t.length;r++){const o=Dt(t[r],e);if(s.push(o),o.type==="error")break}return s};function $o(){return new TransformStream({transform(n,e){Po(n,t=>{const s=t.length;let r;if(s<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,s);else if(s<65536){r=new Uint8Array(3);const o=new DataView(r.buffer);o.setUint8(0,126),o.setUint16(1,s)}else{r=new Uint8Array(9);const o=new DataView(r.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(s))}n.data&&typeof n.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(t)})}})}let mt;function Ke(n){return n.reduce((e,t)=>e+t.length,0)}function Ze(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let s=0;for(let r=0;r<e;r++)t[r]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),t}function Do(n,e){mt||(mt=new TextDecoder);const t=[];let s=0,r=-1,o=!1;return new TransformStream({transform(a,c){for(t.push(a);;){if(s===0){if(Ke(t)<1)break;const l=Ze(t,1);o=(l[0]&128)===128,r=l[0]&127,r<126?s=3:r===126?s=1:s=2}else if(s===1){if(Ke(t)<2)break;const l=Ze(t,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(s===2){if(Ke(t)<8)break;const l=Ze(t,8),d=new DataView(l.buffer,l.byteOffset,l.length),h=d.getUint32(0);if(h>Math.pow(2,21)-1){c.enqueue(St);break}r=h*Math.pow(2,32)+d.getUint32(4),s=3}else{if(Ke(t)<r)break;const l=Ze(t,r);c.enqueue(Dt(o?l:mt.decode(l),e)),s=0}if(r===0||r>n){c.enqueue(St);break}}}})}const Vn=4;function $(n){if(n)return zo(n)}function zo(n){for(var e in $.prototype)n[e]=$.prototype[e];return n}$.prototype.on=$.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};$.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};$.prototype.off=$.prototype.removeListener=$.prototype.removeAllListeners=$.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,r=0;r<t.length;r++)if(s=t[r],s===e||s.fn===e){t.splice(r,1);break}return t.length===0&&delete this._callbacks["$"+n],this};$.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,r=t.length;s<r;++s)t[s].apply(this,e)}return this};$.prototype.emitReserved=$.prototype.emit;$.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};$.prototype.hasListeners=function(n){return!!this.listeners(n).length};const it=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),de=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Fo="arraybuffer";function Un(n,...e){return e.reduce((t,s)=>(n.hasOwnProperty(s)&&(t[s]=n[s]),t),{})}const Ho=de.setTimeout,Vo=de.clearTimeout;function at(n,e){e.useNativeTimers?(n.setTimeoutFn=Ho.bind(de),n.clearTimeoutFn=Vo.bind(de)):(n.setTimeoutFn=de.setTimeout.bind(de),n.clearTimeoutFn=de.clearTimeout.bind(de))}const Uo=1.33;function qo(n){return typeof n=="string"?Yo(n):Math.ceil((n.byteLength||n.size)*Uo)}function Yo(n){let e=0,t=0;for(let s=0,r=n.length;s<r;s++)e=n.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function qn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Xo(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function Wo(n){let e={},t=n.split("&");for(let s=0,r=t.length;s<r;s++){let o=t[s].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class Ko extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class zt extends ${constructor(e){super(),this.writable=!1,at(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Ko(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Dt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Xo(e);return t.length?"?"+t:""}}class Zo extends zt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Bo(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,jo(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=qn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let Yn=!1;try{Yn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Go=Yn;function Qo(){}class Jo extends Zo{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(r,o)=>{this.onError("xhr post error",r,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}}class we extends ${constructor(e,t,s){super(),this.createRequest=e,at(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const t=Un(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&s.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var r;s.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=we.requestsCount++,we.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Qo,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete we.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}we.requestsCount=0;we.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",cn);else if(typeof addEventListener=="function"){const n="onpagehide"in de?"pagehide":"unload";addEventListener(n,cn,!1)}}function cn(){for(let n in we.requests)we.requests.hasOwnProperty(n)&&we.requests[n].abort()}const ei=(function(){const n=Xn({xdomain:!1});return n&&n.responseType!==null})();class ti extends Jo{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=ei&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new we(Xn,this.uri(),e)}}function Xn(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Go))return new XMLHttpRequest}catch{}if(!e)try{return new de[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Wn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ni extends zt{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,s=Wn?{}:Un(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;$t(s,this.supportsBinary,o=>{try{this.doWrite(s,o)}catch{}r&&it(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=qn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const pt=de.WebSocket||de.MozWebSocket;class si extends ni{createSocket(e,t,s){return Wn?new pt(e,t,s):t?new pt(e,t):new pt(e)}doWrite(e,t){this.ws.send(t)}}class ri extends zt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Do(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),r=$o();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const o=()=>{s.read().then(({done:c,value:l})=>{c||(this.onPacket(l),o())}).catch(c=>{})};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],r=t===e.length-1;this._writer.write(s).then(()=>{r&&it(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const oi={websocket:si,webtransport:ri,polling:ti},ii=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ai=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Rt(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),s=n.indexOf("]");t!=-1&&s!=-1&&(n=n.substring(0,t)+n.substring(t,s).replace(/:/g,";")+n.substring(s,n.length));let r=ii.exec(n||""),o={},a=14;for(;a--;)o[ai[a]]=r[a]||"";return t!=-1&&s!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=ci(o,o.path),o.queryKey=li(o,o.query),o}function ci(n,e){const t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function li(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,r,o){r&&(t[r]=o)}),t}const Tt=typeof addEventListener=="function"&&typeof removeEventListener=="function",Qe=[];Tt&&addEventListener("offline",()=>{Qe.forEach(n=>n())},!1);class Oe extends ${constructor(e,t){if(super(),this.binaryType=Fo,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const s=Rt(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=Rt(t.host).host);at(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{const r=s.prototype.name;this.transports.push(r),this._transportsByName[r]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Wo(this.opts.query)),Tt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Qe.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Vn,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Oe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Oe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(t+=qo(r)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,it(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,r){if(typeof t=="function"&&(r=t,t=void 0),typeof s=="function"&&(r=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const o={type:e,data:t,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(Oe.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Tt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=Qe.indexOf(this._offlineEventListener);s!==-1&&Qe.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Oe.protocol=Vn;class ui extends Oe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;Oe.priorWebsocketSuccess=!1;const r=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!s)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Oe.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const m=new Error("probe error");m.transport=t.name,this.emitReserved("upgradeError",m)}}))};function o(){s||(s=!0,h(),t.close(),t=null)}const a=u=>{const m=new Error("probe error: "+u);m.transport=t.name,o(),this.emitReserved("upgradeError",m)};function c(){a("transport closed")}function l(){a("socket closed")}function d(u){t&&u.name!==t.name&&o()}const h=()=>{t.removeListener("open",r),t.removeListener("error",a),t.removeListener("close",c),this.off("close",l),this.off("upgrading",d)};t.once("open",r),t.once("error",a),t.once("close",c),this.once("close",l),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}let di=class extends ui{constructor(e,t={}){const s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(r=>oi[r]).filter(r=>!!r)),super(e,s)}};function hi(n,e="",t){let s=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),s=Rt(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const o=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port+e,s.href=s.protocol+"://"+o+(t&&t.port===s.port?"":":"+s.port),s}const fi=typeof ArrayBuffer=="function",mi=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Kn=Object.prototype.toString,pi=typeof Blob=="function"||typeof Blob<"u"&&Kn.call(Blob)==="[object BlobConstructor]",gi=typeof File=="function"||typeof File<"u"&&Kn.call(File)==="[object FileConstructor]";function Ft(n){return fi&&(n instanceof ArrayBuffer||mi(n))||pi&&n instanceof Blob||gi&&n instanceof File}function Je(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,s=n.length;t<s;t++)if(Je(n[t]))return!0;return!1}if(Ft(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Je(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Je(n[t]))return!0;return!1}function vi(n){const e=[],t=n.data,s=n;return s.data=Mt(t,e),s.attachments=e.length,{packet:s,buffers:e}}function Mt(n,e){if(!n)return n;if(Ft(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let s=0;s<n.length;s++)t[s]=Mt(n[s],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=Mt(n[s],e));return t}return n}function yi(n,e){return n.data=Nt(n.data,e),delete n.attachments,n}function Nt(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Nt(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Nt(n[t],e));return n}const wi=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],xi=5;var O;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(O||(O={}));class bi{constructor(e){this.replacer=e}encode(e){return(e.type===O.EVENT||e.type===O.ACK)&&Je(e)?this.encodeAsBinary({type:e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===O.BINARY_EVENT||e.type===O.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=vi(e),s=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(s),r}}function ln(n){return Object.prototype.toString.call(n)==="[object Object]"}class Ht extends ${constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===O.BINARY_EVENT;s||t.type===O.BINARY_ACK?(t.type=s?O.EVENT:O.ACK,this.reconstructor=new Ci(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Ft(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(O[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===O.BINARY_EVENT||s.type===O.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const a=e.substring(o,t);if(a!=Number(a)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(o,t)}else s.nsp="/";const r=e.charAt(t+1);if(r!==""&&Number(r)==r){const o=t+1;for(;++t;){const a=e.charAt(t);if(a==null||Number(a)!=a){--t;break}if(t===e.length)break}s.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(Ht.isPayloadValid(s.type,o))s.data=o;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case O.CONNECT:return ln(t);case O.DISCONNECT:return t===void 0;case O.CONNECT_ERROR:return typeof t=="string"||ln(t);case O.EVENT:case O.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&wi.indexOf(t[0])===-1);case O.ACK:case O.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ci{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=yi(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ei=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ht,Encoder:bi,get PacketType(){return O},protocol:xi},Symbol.toStringTag,{value:"Module"}));function ge(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const _i=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Zn extends ${constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ge(e,"open",this.onopen.bind(this)),ge(e,"packet",this.onpacket.bind(this)),ge(e,"error",this.onerror.bind(this)),ge(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,r,o;if(_i.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const a={type:O.EVENT,data:t};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const h=this.ids++,u=t.pop();this._registerAckCallback(h,u),a.id=h}const c=(r=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||r===void 0?void 0:r.writable,l=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(e,t){var s;const r=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(r===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===e&&this.sendBuffer.splice(c,1);t.call(this,new Error("operation has timed out"))},r),a=(...c)=>{this.io.clearTimeoutFn(o),t.apply(this,c)};a.withError=!0,this.acks[e]=a}emitWithAck(e,...t){return new Promise((s,r)=>{const o=(a,c)=>a?r(a):s(c);o.withError=!0,t.push(o),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...o)=>s!==this._queue[0]?void 0:(r!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(r)):(this._queue.shift(),t&&t(null,...o)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:O.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case O.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(e);break;case O.ACK:case O.BINARY_ACK:this.onack(e);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...r){s||(s=!0,t.packet({type:O.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function De(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}De.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-t:n+t}return Math.min(n,this.max)|0};De.prototype.reset=function(){this.attempts=0};De.prototype.setMin=function(n){this.ms=n};De.prototype.setMax=function(n){this.max=n};De.prototype.setJitter=function(n){this.jitter=n};class Ot extends ${constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,at(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new De({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||Ei;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new di(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=ge(t,"open",function(){s.onopen(),e&&e()}),o=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},a=ge(t,"error",o);if(this._timeout!==!1){const c=this._timeout,l=this.setTimeoutFn(()=>{r(),o(new Error("timeout")),t.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ge(e,"ping",this.onping.bind(this)),ge(e,"data",this.ondata.bind(this)),ge(e,"error",this.onerror.bind(this)),ge(e,"close",this.onclose.bind(this)),ge(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){it(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Zn(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t)if(this.nsps[s].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ze={};function et(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=hi(n,e.path||"/socket.io"),s=t.source,r=t.id,o=t.path,a=ze[r]&&o in ze[r].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let l;return c?l=new Ot(s,e):(ze[r]||(ze[r]=new Ot(s,e)),l=ze[r]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(et,{Manager:Ot,Socket:Zn,io:et,connect:et});const Si="https://api.silent-talk.online",Ri="/socket.io";let X=null;const Ti=()=>{X=et(Si,{autoConnect:!1,path:Ri,extraHeaders:{Authorization:`Bearer ${hs()}`}})};class st{static toDomain(e){return{chat:void 0,updatedAt:e.updatedAt,type:e.type,id:e.id,text:e.text,createdAt:e.createdAt,medias:e.medias?.map(st.mediaToDomain)||[],replyTo:e.replyTo?st.toDomain(e.replyTo):void 0,replies:[],user:e.user?fs.toDomain(e.user):void 0}}static mediaToDomain(e){return{id:e.id,type:e.type,url:e.url,createdAt:e.createdAt,updatedAt:e.updatedAt,message:void 0}}}const Mi=async(n,e)=>Se({method:"POST",url:`/messages/${n}`,data:e}),Ni=async(n,e)=>Se({method:"DELETE",url:`/messages/${n}/${e}`}),Oi=async(n,e,t)=>Se({method:"PATCH",url:`/messages/${n}/${e}`,data:{text:t}}),ki=async(n,e)=>{const t=await Se({method:"GET",url:`/messages/${n}`,params:e});console.log("Raw response data: ",t);const s=t.data.map(st.toDomain);return console.log("Converted data: ",s),{...t,data:s}},ct={sendMessage:Mi,deleteMessage:Ni,editMessage:Oi,getAllMessages:ki},Pi=25,Ii=300,Ai=(n,e)=>{const t=ms(),s=i.useMemo(()=>["chat-messages",n],[n]),{data:r,error:o,fetchNextPage:a,hasNextPage:c,isLoading:l,isError:d,isFetchingNextPage:h}=to({queryKey:s,queryFn:async({pageParam:m})=>{const p=await ct.getAllMessages(n,{page:m,limit:Pi});return console.log("Messages in queryFn:",p),p},initialPageParam:1,getNextPageParam:m=>m.currentPage<m.totalPages?m.currentPage+1:void 0,staleTime:1});console.log("Error in useChatMessages:",o),i.useEffect(()=>{if(!X||!n)return;X.connected||X.connect();const m=()=>{console.log(`[Socket] Emitting 'join_chat' for chatId: ${n}`),X&&X.emit("join_chat",n)};X.connected?m():X.on("connect",m);const p=b=>{t.setQueryData(s,_=>{if(!_)return _;const S=_.pages.map((R,y)=>y===0?{...R,data:[...R.data,b]}:R);return{..._,pages:S}}),(e&&"current"in e&&e.current?e.current.scrollHeight-e.current.scrollTop-e.current.clientHeight<Ii:!1)?setTimeout(()=>{e&&"current"in e&&e.current&&(e.current.scrollTop=e.current.scrollHeight)},250):fe("Пришло новое сообщение","info")},g=b=>{t.setQueryData(s,w=>{if(!w)return w;const _=w.pages.map(S=>({...S,data:S.data.map(R=>R.id===b.id?b:R)}));return{...w,pages:_}})},v=b=>{t.setQueryData(s,w=>{if(!w)return w;const _=w.pages.map(S=>({...S,data:S.data.filter(R=>R.id!==b)}));return{...w,pages:_}})};return X.on("new_message",p),X.on("message_updated",g),X.on("message_deleted",v),()=>{X&&(X.off("new_message",p),X.off("message_updated",g),X.off("message_deleted",v),X.emit("leave_chat",n),X.off("connect",m))}},[n,t,s,e]),i.useLayoutEffect(()=>{Ti()},[]),console.log("Data pages in useChatMessages:",r?.pages);const u=i.useMemo(()=>r?.pages?r.pages.slice().reverse().flatMap(m=>m.data):[],[r]);return console.log("useChatMessages messages",u),{messages:u,isLoading:l,isError:d,error:o,fetchNextPage:a,hasNextPage:c,isFetchingNextPage:h}},Li=({afterSuccess:n=Be,afterError:e=Be,showSuccessNotification:t=!0,showErrorNotification:s=!1,chatId:r=""})=>{const{error:o,isPending:a,mutateAsync:c,isError:l}=rt({mutationFn:async d=>await ct.deleteMessage(r,d),onSuccess:async()=>{t&&fe("Сообщение успешно удалено!","success"),n&&n()},onError:async d=>{s&&fe(d.message,"error"),e&&e()}});return{loading:a,deleteMessage:c,error:l?o?.message:[]}},ji=Pt({type:xn(he),url:It({message:"URL медиафайла должен быть валидным."})}),Bi=Pt({type:xn($e),text:It().min(0,{message:"Текст сообщения не может быть пустым."}).max(2e3,{message:"Текст сообщения не должен превышать 2000 символов."}).optional(),replyToId:Ls({message:"ID сообщения для ответа должен быть в формате UUID."}).optional(),medias:As(ji).optional()}).superRefine((n,e)=>{const t=!!n.text&&n.text.trim().length>0,s=!!n.medias&&n.medias.length>0;!t&&!s&&e.addIssue({code:"custom",message:"Сообщение должно содержать либо текст, либо медиафайлы.",path:["text"]})}),$i=({afterSuccess:n=Be,afterError:e=Be,showSuccessNotification:t=!0,showErrorNotification:s=!1,clearForm:r=!1,chatId:o="",chatRef:a})=>{const[c,l]=i.useState(null),{error:d,isPending:h,mutateAsync:u,isError:m}=rt({mutationFn:async v=>await ct.sendMessage(o,v),onSuccess:async()=>{t&&fe("Сообщение успешно отправлено!","success"),n&&n()},onError:async v=>{s&&fe(v.message,"error"),e&&e()}}),p=bn({mode:"all",reValidateMode:"onChange",resolver:Cn(Bi)}),g=p.handleSubmit(async v=>{a&&typeof a!="function"&&a.current&&a.current.scrollTo(0,a.current.scrollHeight),console.log("Triggered",v),await u({...v,replyToId:c?.id}),r&&p.reset(),l(null)});return{form:p,loading:h,sendMessage:g,error:m?d?.message:[],replyMessage:c,setReplyMessage:l,sendMessageMutation:u}},Di=Pt({text:It().min(1,{message:"Текст сообщения не может быть пустым."}).max(2e3,{message:"Текст сообщения не должен превышать 2000 символов."})}),zi=({afterSuccess:n=Be,afterError:e=Be,showSuccessNotification:t=!0,showErrorNotification:s=!1,clearForm:r=!1,chatId:o=""})=>{const[a,c]=i.useState(null),{error:l,isPending:d,mutateAsync:h,isError:u}=rt({mutationFn:async v=>await ct.editMessage(o,a?.id||"",v.text),onSuccess:async()=>{t&&fe("Сообщение успешно обновлено!","success"),n&&n()},onError:async v=>{s&&fe(v.message,"error"),e&&e()}}),m=bn({mode:"all",reValidateMode:"onChange",resolver:Cn(Di)}),p=m.handleSubmit(async v=>{a&&(await h(v),r&&m.reset(),c(null))}),g=i.useCallback(v=>{c(v),m.reset({text:v?.text||""})},[m]);return{form:m,loading:d,updateMessage:p,error:u?l?.message:[],editMessage:a,setEditMessage:g}},Fi=async n=>Se({data:n,headers:{"Content-Type":"multipart/form-data"},method:"POST",url:"/upload/video"}),Hi=async n=>Se({data:n,headers:{"Content-Type":"multipart/form-data"},method:"POST",url:"/upload/photo"}),Vi=async n=>Se({data:n,headers:{"Content-Type":"multipart/form-data"},method:"POST",url:"/upload/document"}),Ui=async n=>Se({data:n,headers:{"Content-Type":"multipart/form-data"},method:"POST",url:"/upload/audio"}),qi=async n=>Se({data:n,headers:{"Content-Type":"multipart/form-data"},method:"POST",url:"/upload/voice"}),Fe={uploadVideo:Fi,uploadPhoto:Hi,uploadDocument:Vi,uploadAudio:Ui,uploadVoice:qi},gt={photo:{uploadFn:Fe.uploadPhoto,formDataKey:"photo"},video:{uploadFn:Fe.uploadVideo,formDataKey:"video"},document:{uploadFn:Fe.uploadDocument,formDataKey:"document"},audio:{uploadFn:Fe.uploadAudio,formDataKey:"audio"},voice:{uploadFn:Fe.uploadVoice,formDataKey:"voice"}},Gn=()=>{const{isPending:n,mutateAsync:e,error:t}=rt({mutationFn:({type:o,fileFormData:a})=>{const{uploadFn:c}=gt[o];return c(a)},onError:o=>{fe(o.message,"error")}}),s=i.useCallback(async(o,a,c)=>{const{formDataKey:l}=gt[o],d=new FormData;d.append(l,a);try{const h=await e({type:o,fileFormData:d});return c&&c(h.url),h.url}catch(h){console.error("Upload failed:",h),fe("Upload failed. Please try again.","error");return}},[e]),r=i.useCallback(async(o,a,c)=>{const{formDataKey:l}=gt[o],d=[];try{for(const u of a){const m=new FormData;m.append(l,u);const p=await e({type:o,fileFormData:m});d.push(p.url)}const h=d.join(",");return c&&c(h),h}catch(h){fe("One or more uploads failed. Please try again.","error"),console.error("Multiple upload failed:",h);return}},[e]);return{isLoading:n,error:t?.message??null,handleUpload:s,handleMultipleUpload:r}},Yi=({createNewMessage:n})=>{const{handleUpload:e,isLoading:t}=Gn(),[s,r]=i.useState(!1),[o,a]=i.useState(0),c=i.useRef(null);i.useEffect(()=>(s?c.current=setInterval(()=>{a(g=>g+1)},1e3):a(0),()=>{c.current&&clearInterval(c.current)}),[s]);const l=i.useRef(null),d=i.useRef([]),h=i.useCallback(async()=>{if(d.current.length===0)return;const g=new Blob(d.current,{type:"audio/webm"}),v=new File([g],"voice-message.webm",{type:"audio/webm"});d.current=[];try{const b=await e("voice",v);b?n({type:$e.VOICE,medias:[{type:he.VOICE,url:b}]}):fe("Failed to upload voice message. Please try again.","error")}catch(b){console.error("Error during voice message upload:",b)}},[e,n]),u=i.useCallback(async()=>{try{const g=await navigator.mediaDevices.getUserMedia({audio:!0});r(!0);const v=new MediaRecorder(g);l.current=v,d.current=[],v.start(),v.ondataavailable=b=>{b.data.size>0&&d.current.push(b.data)},v.onstop=h}catch(g){fe("Microphone access was denied.","error"),r(!1),console.log("Error accessing microphone:",g)}},[h]),m=i.useCallback(()=>{l.current&&s&&(l.current.stop(),l.current.stream.getTracks().forEach(g=>g.stop()),r(!1))},[s]),p=i.useCallback(()=>{l.current&&s&&(l.current.onstop=null,l.current.stop(),l.current.stream.getTracks().forEach(g=>g.stop()),r(!1),d.current=[])},[s]);return{isRecording:s,isUploading:t,startRecording:u,stopRecording:m,cancelRecording:p,recordingTimer:o}},Xi=({ref:n,threshold:e=100})=>{const[t,s]=i.useState(!1);i.useEffect(()=>{if(!n||!("current"in n)||!n.current)return;const o=()=>{if(!n.current)return;const{scrollTop:c,scrollHeight:l,clientHeight:d}=n.current;s(l-c-d<=e)},a=n.current;return a.addEventListener("scroll",o),o(),()=>{a.removeEventListener("scroll",o)}},[n,e]);const r=i.useCallback(()=>{n&&"current"in n&&n.current&&(n.current.scrollTop=n.current.scrollHeight)},[n]);return{isAtBottom:t,scrollToBottom:r}},Wi=({children:n,clearForm:e,showErrorNotification:t,showSuccessNotification:s,afterError:r,afterSuccess:o,chatId:a=""})=>{const[c,l]=i.useState("default"),d=i.useRef(null),{isAtBottom:h}=Xi({ref:d,threshold:300}),{messages:u,isFetchingNextPage:m,hasNextPage:p,fetchNextPage:g}=Ai(a,d),{loading:v,form:b,sendMessage:w,setReplyMessage:_,replyMessage:S,sendMessageMutation:R}=$i({chatId:a,clearForm:e,showErrorNotification:t,showSuccessNotification:s,afterError:r,afterSuccess:o,chatRef:d}),{loading:y,form:N,updateMessage:C,setEditMessage:x,editMessage:T}=zi({chatId:a,clearForm:e,showErrorNotification:t,showSuccessNotification:s,afterError:r,afterSuccess:o}),{loading:M,deleteMessage:E}=Li({chatId:a,showErrorNotification:t,showSuccessNotification:s,afterError:r,afterSuccess:o}),{handleMultipleUpload:P,isLoading:k}=Gn(),{startRecording:I,stopRecording:D,recordingTimer:K,isUploading:U,cancelRecording:Z}=Yi({createNewMessage:R}),z=i.useCallback(L=>{x(L),l(L?"edit":"default")},[x]),q=i.useCallback(()=>{z(null)},[z]),G=i.useCallback(()=>{I(),l("voice")},[I]),ee=i.useCallback(()=>{D(),l("default")},[D]),Q=i.useCallback(()=>{Z(),l("default")},[Z]),ce=i.useMemo(()=>{const se={mutationLoading:v||y||k||U||M,chatRef:d,handleDeleteMessage:E,handleMultipleUpload:P,replyToMessage:S,setReplyToMessage:_,setEditMessage:z,startRecording:G};return c==="edit"&&T?{...se,mode:"edit",isRecording:!1,editMessage:T,chatForm:N,handleSubmit:C,cancelEdit:q}:c==="voice"?{...se,mode:"voice",isRecording:!0,editMessage:null,recordingTimer:K,stopRecording:ee,cancelRecording:Q}:{...se,mode:"default",isRecording:!1,editMessage:null,chatForm:b,handleSubmit:w}},[c,v,y,k,U,M,E,P,S,_,T,N,C,ee,Q,z,G,q,K,b,w]),ne=i.useMemo(()=>({loading:m,chatRef:d,setReplyToMessage:_,setEditMessage:z,messages:u,mutationLoading:v||y||k||U||M,handleDeleteMessage:E,isAtBottom:h,isFetchingMore:m,hasMore:p,fetchMoreMessages:g,error:null}),[m,d,_,z,u,v,y,k,U,M,E,h,p,g]);return console.log("Messages in Chat Widget:",u),f.jsx(lo,{value:ne,children:f.jsx(Ro,{value:ce,children:n})})},Ki=i.memo(Wi),Zi=({children:n})=>{const{loading:e,refetch:t,me:s,error:r}=ps();return f.jsx(uo,{error:r,loading:e,me:s,refetch:t,children:n})},Gi=i.memo(Zi),{Content:Qi}=_e,Ji=()=>{const e=gs().chatId||"";return f.jsx("main",{children:f.jsxs(_e,{className:"h-[100dvh]",children:[f.jsx(co,{chatId:e}),f.jsx(_e,{children:f.jsx(Qi,{className:"flex flex-col",children:f.jsx(Gi,{children:f.jsxs(Ki,{clearForm:!0,chatId:e,showErrorNotification:!0,showSuccessNotification:!1,children:[f.jsx(So,{}),f.jsx(ko,{})]})})})})]})})},ra=i.memo(Ji);export{ra as default};
